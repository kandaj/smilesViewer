function AppViewModel(){var r=this,o=this;this.fileInvalid=ko.observable(),this.fileInfo=ko.observable(),this.xyzCoordinates=ko.observable(""),this.loader=ko.observable(""),this.resError=ko.observable(""),this.clearData=function(e,t){t.preventDefault(),r.reader.abort(),r.xyzCoordinates(""),r.fileInfo(""),r.fileInvalid(""),r.resError("")},this.acceptDrop=function(e,t){var r=t.dataTransfer.files,n=new FileReader(e);(o.reader=n).onload=function(){var e=n.result.trim();o.vaildateFile(e),o.fileInfo(r[0].name)},n.onerror=function(e){alert(e.target.error.name)},n.readAsText(r[0])},this.dragover=function(e,t){t.stopPropagation(),t.preventDefault()},this.vaildateFile=function(e){var t=e.split(/\r\n|\n|\s/);!t[0]||1<t.length?r.fileInvalid(!0):r.fileInvalid(!1),o.fileInvalid()?r.xyzCoordinates(""):(r.loader(!0),console.log("SMILES"+e),r.getCoordinates(e).then(function(e){r.generate3DModel(),r.loader(!1)}))},this.getCoordinates=function(e){var t="https://www.ebi.ac.uk/chembl/api/utils/smiles2ctab/"+btoa(e);return axios.get(t).then(function(e){var t="https://www.ebi.ac.uk/chembl/api/utils/ctab2xyz/"+btoa(e.data);return axios.get(t)}).then(function(e){return r.xyzCoordinates(e.data)}).catch(function(e){console.log(e),r.loader(!1),r.resError(!0)})},this.generate3DModel=function(){var e={containerId:"renderContainer",canvasId:"renderCanvas",resolution:300,xyzCoordinates:r.xyzCoordinates()};generateModel(e)}}!function a(s,i,u){function m(t,e){if(!i[t]){if(!s[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=i[t]={exports:{}};s[t][0].call(o.exports,function(e){return m(s[t][1][e]||e)},o,o.exports,a,s,i,u)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)m(u[e]);return m}({1:[function(e,t,r){var s,i=e("./renderer"),u=e("./view"),m=e("./system"),l=e("./xyz"),c=m.new(),f=u.new(),p=null,d=!1;window.generateModel=function(e){s=document.getElementById(e.containerId);var t=document.getElementById(e.canvasId);p=new i(t,e.resolution,f.aoRes);var n=0,o=0,a=!1;s.addEventListener("mousedown",function(e){document.body.style.cursor="none",0==e.button&&(a=!0),n=e.clientX,o=e.clientY}),window.addEventListener("mouseup",function(e){document.body.style.cursor="",0==e.button&&(a=!1)}),setInterval(function(){a||(document.body.style.cursor="")},10),window.addEventListener("mousemove",function(e){if(a){var t=e.clientX-n,r=e.clientY-o;0==t&&0==r||(n=e.clientX,o=e.clientY,e.shiftKey?u.translate(f,t,r):u.rotate(f,t,r),d=!0)}}),function(e){c=m.new();for(var t=0;t<e.length;t++){var r=e[t],n=r.position[0],o=r.position[1],a=r.position[2];m.addAtom(c,r.symbol,n,o,a)}m.center(c),m.calculateBonds(c),p.setSystem(c,f),u.center(f,c),d=!0}(l(e.xyzCoordinates)[0]),function e(){d&&(p.reset(),d=!1),p.render(f),requestAnimationFrame(e)}()}},{"./renderer":6,"./system":7,"./view":8,"./xyz":10}],2:[function(e,t,r){"use strict";for(var n=e("./elements"),o=1/0,a=-1/0,s=0;s<=118;s++)o=Math.min(o,n[s].radius),a=Math.max(a,n[s].radius);t.exports.MIN_ATOM_RADIUS=o,t.exports.MAX_ATOM_RADIUS=a},{"./elements":4}],3:[function(e,t,r){t.exports={position:[-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,1],normal:[-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},{}],4:[function(e,t,r){t.exports={},t.exports[0]=t.exports.Xx={symbol:"Xx",name:"unknown",mass:1,radius:1,color:[1,.078,.576],number:0},t.exports[1]=t.exports.H={symbol:"H",name:"hydrogen",mass:1.00794,radius:.31,color:[1,1,1],number:1},t.exports[2]=t.exports.He={symbol:"He",name:"helium",mass:4.002602,radius:.28,color:[.851,1,1],number:2},t.exports[3]=t.exports.Li={symbol:"Li",name:"lithium",mass:6.941,radius:1.28,color:[.8,.502,1],number:3},t.exports[4]=t.exports.Be={symbol:"Be",name:"beryllium",mass:9.012182,radius:.96,color:[.761,1,0],number:4},t.exports[5]=t.exports.B={symbol:"B",name:"boron",mass:10.811,radius:.84,color:[1,.71,.71],number:5},t.exports[6]=t.exports.C={symbol:"C",name:"carbon",mass:12.0107,radius:.73,color:[.565,.565,.565],number:6},t.exports[7]=t.exports.N={symbol:"N",name:"nitrogen",mass:14.0067,radius:.71,color:[.188,.314,.973],number:7},t.exports[8]=t.exports.O={symbol:"O",name:"oxygen",mass:15.9994,radius:.66,color:[1,.051,.051],number:8},t.exports[9]=t.exports.F={symbol:"F",name:"fluorine",mass:18.9984032,radius:.57,color:[.565,.878,.314],number:9},t.exports[10]=t.exports.Ne={symbol:"Ne",name:"neon",mass:20.1797,radius:.58,color:[.702,.89,.961],number:10},t.exports[11]=t.exports.Na={symbol:"Na",name:"sodium",mass:22.98976928,radius:1.66,color:[.671,.361,.949],number:11},t.exports[12]=t.exports.Mg={symbol:"Mg",name:"magnesium",mass:24.305,radius:1.41,color:[.541,1,0],number:12},t.exports[13]=t.exports.Al={symbol:"Al",name:"aluminum",mass:26.9815386,radius:1.21,color:[.749,.651,.651],number:13},t.exports[14]=t.exports.Si={symbol:"Si",name:"silicon",mass:28.0855,radius:1.11,color:[.941,.784,.627],number:14},t.exports[15]=t.exports.P={symbol:"P",name:"phosphorus",mass:30.973762,radius:1.07,color:[1,.502,0],number:15},t.exports[16]=t.exports.S={symbol:"S",name:"sulfur",mass:32.065,radius:1.05,color:[1,1,.188],number:16},t.exports[17]=t.exports.Cl={symbol:"Cl",name:"chlorine",mass:35.453,radius:1.02,color:[.122,.941,.122],number:17},t.exports[18]=t.exports.Ar={symbol:"Ar",name:"argon",mass:39.948,radius:1.06,color:[.502,.82,.89],number:18},t.exports[19]=t.exports.K={symbol:"K",name:"potassium",mass:39.0983,radius:2.03,color:[.561,.251,.831],number:19},t.exports[20]=t.exports.Ca={symbol:"Ca",name:"calcium",mass:40.078,radius:1.76,color:[.239,1,0],number:20},t.exports[21]=t.exports.Sc={symbol:"Sc",name:"scandium",mass:44.955912,radius:1.7,color:[.902,.902,.902],number:21},t.exports[22]=t.exports.Ti={symbol:"Ti",name:"titanium",mass:47.867,radius:1.6,color:[.749,.761,.78],number:22},t.exports[23]=t.exports.V={symbol:"V",name:"vanadium",mass:50.9415,radius:1.53,color:[.651,.651,.671],number:23},t.exports[24]=t.exports.Cr={symbol:"Cr",name:"chromium",mass:51.9961,radius:1.39,color:[.541,.6,.78],number:24},t.exports[25]=t.exports.Mn={symbol:"Mn",name:"manganese",mass:54.938045,radius:1.39,color:[.611,.478,.78],number:25},t.exports[26]=t.exports.Fe={symbol:"Fe",name:"iron",mass:55.845,radius:1.32,color:[.878,.4,.2],number:26},t.exports[27]=t.exports.Co={symbol:"Co",name:"cobalt",mass:58.6934,radius:1.26,color:[.941,.565,.627],number:27},t.exports[28]=t.exports.Ni={symbol:"Ni",name:"nickel",mass:58.933195,radius:1.24,color:[.314,.816,.314],number:28},t.exports[29]=t.exports.Cu={symbol:"Cu",name:"copper",mass:63.546,radius:1.32,color:[.784,.502,.2],number:29},t.exports[30]=t.exports.Zn={symbol:"Zn",name:"zinc",mass:65.38,radius:1.22,color:[.49,.502,.69],number:30},t.exports[31]=t.exports.Ga={symbol:"Ga",name:"gallium",mass:69.723,radius:1.22,color:[.761,.561,.561],number:31},t.exports[32]=t.exports.Ge={symbol:"Ge",name:"germanium",mass:72.64,radius:1.2,color:[.4,.561,.561],number:32},t.exports[33]=t.exports.As={symbol:"As",name:"arsenic",mass:74.9216,radius:1.19,color:[.741,.502,.89],number:33},t.exports[34]=t.exports.Se={symbol:"Se",name:"selenium",mass:78.96,radius:1.2,color:[1,.631,0],number:34},t.exports[35]=t.exports.Br={symbol:"Br",name:"bromine",mass:79.904,radius:1.2,color:[.651,.161,.161],number:35},t.exports[36]=t.exports.Kr={symbol:"Kr",name:"krypton",mass:83.798,radius:1.16,color:[.361,.722,.82],number:36},t.exports[37]=t.exports.Rb={symbol:"Rb",name:"rubidium",mass:85.4678,radius:2.2,color:[.439,.18,.69],number:37},t.exports[38]=t.exports.Sr={symbol:"Sr",name:"strontium",mass:87.62,radius:1.95,color:[0,1,0],number:38},t.exports[39]=t.exports.Y={symbol:"Y",name:"yttrium",mass:88.90585,radius:1.9,color:[.58,1,1],number:39},t.exports[40]=t.exports.Zr={symbol:"Zr",name:"zirconium",mass:91.224,radius:1.75,color:[.58,.878,.878],number:40},t.exports[41]=t.exports.Nb={symbol:"Nb",name:"niobium",mass:92.90638,radius:1.64,color:[.451,.761,.788],number:41},t.exports[42]=t.exports.Mo={symbol:"Mo",name:"molybdenum",mass:95.96,radius:1.54,color:[.329,.71,.71],number:42},t.exports[43]=t.exports.Tc={symbol:"Tc",name:"technetium",mass:98,radius:1.47,color:[.231,.62,.62],number:43},t.exports[44]=t.exports.Ru={symbol:"Ru",name:"ruthenium",mass:101.07,radius:1.46,color:[.141,.561,.561],number:44},t.exports[45]=t.exports.Rh={symbol:"Rh",name:"rhodium",mass:102.9055,radius:1.42,color:[.039,.49,.549],number:45},t.exports[46]=t.exports.Pd={symbol:"Pd",name:"palladium",mass:106.42,radius:1.39,color:[0,.412,.522],number:46},t.exports[47]=t.exports.Ag={symbol:"Ag",name:"silver",mass:107.8682,radius:1.45,color:[.753,.753,.753],number:47},t.exports[48]=t.exports.Cd={symbol:"Cd",name:"cadmium",mass:112.411,radius:1.44,color:[1,.851,.561],number:48},t.exports[49]=t.exports.In={symbol:"In",name:"indium",mass:114.818,radius:1.42,color:[.651,.459,.451],number:49},t.exports[50]=t.exports.Sn={symbol:"Sn",name:"tin",mass:118.71,radius:1.39,color:[.4,.502,.502],number:50},t.exports[51]=t.exports.Sb={symbol:"Sb",name:"antimony",mass:121.76,radius:1.39,color:[.62,.388,.71],number:51},t.exports[52]=t.exports.Te={symbol:"Te",name:"tellurium",mass:127.6,radius:1.38,color:[.831,.478,0],number:52},t.exports[53]=t.exports.I={symbol:"I",name:"iodine",mass:126.9047,radius:1.39,color:[.58,0,.58],number:53},t.exports[54]=t.exports.Xe={symbol:"Xe",name:"xenon",mass:131.293,radius:1.4,color:[.259,.62,.69],number:54},t.exports[55]=t.exports.Cs={symbol:"Cs",name:"cesium",mass:132.9054519,radius:2.44,color:[.341,.09,.561],number:55},t.exports[56]=t.exports.Ba={symbol:"Ba",name:"barium",mass:137.327,radius:2.15,color:[0,.788,0],number:56},t.exports[57]=t.exports.La={symbol:"La",name:"lanthanum",mass:138.90547,radius:2.07,color:[.439,.831,1],number:57},t.exports[58]=t.exports.Ce={symbol:"Ce",name:"cerium",mass:140.116,radius:2.04,color:[1,1,.78],number:58},t.exports[59]=t.exports.Pr={symbol:"Pr",name:"praseodymium",mass:140.90765,radius:2.03,color:[.851,1,.78],number:59},t.exports[60]=t.exports.Nd={symbol:"Nd",name:"neodymium",mass:144.242,radius:2.01,color:[.78,1,.78],number:60},t.exports[61]=t.exports.Pm={symbol:"Pm",name:"promethium",mass:145,radius:1.99,color:[.639,1,.78],number:61},t.exports[62]=t.exports.Sm={symbol:"Sm",name:"samarium",mass:150.36,radius:1.98,color:[.561,1,.78],number:62},t.exports[63]=t.exports.Eu={symbol:"Eu",name:"europium",mass:151.964,radius:1.98,color:[.38,1,.78],number:63},t.exports[64]=t.exports.Gd={symbol:"Gd",name:"gadolinium",mass:157.25,radius:1.96,color:[.271,1,.78],number:64},t.exports[65]=t.exports.Tb={symbol:"Tb",name:"terbium",mass:158.92535,radius:1.94,color:[.189,1,.78],number:65},t.exports[66]=t.exports.Dy={symbol:"Dy",name:"dysprosium",mass:162.5,radius:1.92,color:[.122,1,.78],number:66},t.exports[67]=t.exports.Ho={symbol:"Ho",name:"holmium",mass:164.93032,radius:1.92,color:[0,1,.612],number:67},t.exports[68]=t.exports.Er={symbol:"Er",name:"erbium",mass:167.259,radius:1.89,color:[0,.902,.459],number:68},t.exports[69]=t.exports.Tm={symbol:"Tm",name:"thulium",mass:168.93421,radius:1.9,color:[0,.831,.322],number:69},t.exports[70]=t.exports.Yb={symbol:"Yb",name:"ytterbium",mass:173.054,radius:1.87,color:[0,.749,.22],number:70},t.exports[71]=t.exports.Lu={symbol:"Lu",name:"lutetium",mass:174.9668,radius:1.87,color:[0,.671,.141],number:71},t.exports[72]=t.exports.Hf={symbol:"Hf",name:"hafnium",mass:178.49,radius:1.75,color:[.302,.761,1],number:72},t.exports[73]=t.exports.Ta={symbol:"Ta",name:"tantalum",mass:180.94788,radius:1.7,color:[.302,.651,1],number:73},t.exports[74]=t.exports.W={symbol:"W",name:"tungsten",mass:183.84,radius:1.62,color:[.129,.58,.839],number:74},t.exports[75]=t.exports.Re={symbol:"Re",name:"rhenium",mass:186.207,radius:1.51,color:[.149,.49,.671],number:75},t.exports[76]=t.exports.Os={symbol:"Os",name:"osmium",mass:190.23,radius:1.44,color:[.149,.4,.588],number:76},t.exports[77]=t.exports.Ir={symbol:"Ir",name:"iridium",mass:192.217,radius:1.41,color:[.09,.329,.529],number:77},t.exports[78]=t.exports.Pt={symbol:"Pt",name:"platinum",mass:195.084,radius:1.36,color:[.816,.816,.878],number:78},t.exports[79]=t.exports.Au={symbol:"Au",name:"gold",mass:196.966569,radius:1.36,color:[1,.82,.137],number:79},t.exports[80]=t.exports.Hg={symbol:"Hg",name:"mercury",mass:200.59,radius:1.32,color:[.722,.722,.816],number:80},t.exports[81]=t.exports.Tl={symbol:"Tl",name:"thallium",mass:204.3833,radius:1.45,color:[.651,.329,.302],number:81},t.exports[82]=t.exports.Pb={symbol:"Pb",name:"lead",mass:207.2,radius:1.46,color:[.341,.349,.38],number:82},t.exports[83]=t.exports.Bi={symbol:"Bi",name:"bismuth",mass:208.9804,radius:1.48,color:[.62,.31,.71],number:83},t.exports[84]=t.exports.Po={symbol:"Po",name:"polonium",mass:210,radius:1.4,color:[.671,.361,0],number:84},t.exports[85]=t.exports.At={symbol:"At",name:"astatine",mass:210,radius:1.5,color:[.459,.31,.271],number:85},t.exports[86]=t.exports.Rn={symbol:"Rn",name:"radon",mass:220,radius:1.5,color:[.259,.51,.588],number:86},t.exports[87]=t.exports.Fr={symbol:"Fr",name:"francium",mass:223,radius:2.6,color:[.259,0,.4],number:87},t.exports[88]=t.exports.Ra={symbol:"Ra",name:"radium",mass:226,radius:2.21,color:[0,.49,0],number:88},t.exports[89]=t.exports.Ac={symbol:"Ac",name:"actinium",mass:227,radius:2.15,color:[.439,.671,.98],number:89},t.exports[90]=t.exports.Th={symbol:"Th",name:"thorium",mass:231.03588,radius:2.06,color:[0,.729,1],number:90},t.exports[91]=t.exports.Pa={symbol:"Pa",name:"protactinium",mass:232.03806,radius:2,color:[0,.631,1],number:91},t.exports[92]=t.exports.U={symbol:"U",name:"uranium",mass:237,radius:1.96,color:[0,.561,1],number:92},t.exports[93]=t.exports.Np={symbol:"Np",name:"neptunium",mass:238.02891,radius:1.9,color:[0,.502,1],number:93},t.exports[94]=t.exports.Pu={symbol:"Pu",name:"plutonium",mass:243,radius:1.87,color:[0,.42,1],number:94},t.exports[95]=t.exports.Am={symbol:"Am",name:"americium",mass:244,radius:1.8,color:[.329,.361,.949],number:95},t.exports[96]=t.exports.Cm={symbol:"Cm",name:"curium",mass:247,radius:1.69,color:[.471,.361,.89],number:96},t.exports[97]=t.exports.Bk={symbol:"Bk",name:"berkelium",mass:247,radius:1.66,color:[.541,.31,.89],number:97},t.exports[98]=t.exports.Cf={symbol:"Cf",name:"californium",mass:251,radius:1.68,color:[.631,.212,.831],number:98},t.exports[99]=t.exports.Es={symbol:"Es",name:"einsteinium",mass:252,radius:1.65,color:[.702,.122,.831],number:99},t.exports[100]=t.exports.Fm={symbol:"Fm",name:"fermium",mass:257,radius:1.67,color:[.702,.122,.729],number:100},t.exports[101]=t.exports.Md={symbol:"Md",name:"mendelevium",mass:258,radius:1.73,color:[.702,.051,.651],number:101},t.exports[102]=t.exports.No={symbol:"No",name:"nobelium",mass:259,radius:1.76,color:[.741,.051,.529],number:102},t.exports[103]=t.exports.Lr={symbol:"Lr",name:"lawrencium",mass:262,radius:1.61,color:[.78,0,.4],number:103},t.exports[104]=t.exports.Rf={symbol:"Rf",name:"rutherfordium",mass:261,radius:1.57,color:[.8,0,.349],number:104},t.exports[105]=t.exports.Db={symbol:"Db",name:"dubnium",mass:262,radius:1.49,color:[.82,0,.31],number:105},t.exports[106]=t.exports.Sg={symbol:"Sg",name:"seaborgium",mass:266,radius:1.43,color:[.851,0,.271],number:106},t.exports[107]=t.exports.Bh={symbol:"Bh",name:"bohrium",mass:264,radius:1.41,color:[.878,0,.22],number:107},t.exports[108]=t.exports.Hs={symbol:"Hs",name:"hassium",mass:277,radius:1.34,color:[.902,0,.18],number:108},t.exports[109]=t.exports.Mt={symbol:"Mt",name:"meitnerium",mass:268,radius:1.29,color:[.922,0,.149],number:109},t.exports[110]=t.exports.Ds={symbol:"Ds",name:"Ds",mass:271,radius:1.28,color:[.922,0,.149],number:110},t.exports[111]=t.exports.Uuu={symbol:"Uuu",name:"Uuu",mass:272,radius:1.21,color:[.922,0,.149],number:111},t.exports[112]=t.exports.Uub={symbol:"Uub",name:"Uub",mass:285,radius:1.22,color:[.922,0,.149],number:112},t.exports[113]=t.exports.Uut={symbol:"Uut",name:"Uut",mass:284,radius:1.36,color:[.922,0,.149],number:113},t.exports[114]=t.exports.Uuq={symbol:"Uuq",name:"Uuq",mass:289,radius:1.43,color:[.922,0,.149],number:114},t.exports[115]=t.exports.Uup={symbol:"Uup",name:"Uup",mass:288,radius:1.62,color:[.922,0,.149],number:115},t.exports[116]=t.exports.Uuh={symbol:"Uuh",name:"Uuh",mass:292,radius:1.75,color:[.922,0,.149],number:116},t.exports[117]=t.exports.Uus={symbol:"Uus",name:"Uus",mass:294,radius:1.65,color:[.922,0,.149],number:117},t.exports[118]=t.exports.Uuo={symbol:"Uuo",name:"Uuo",mass:296,radius:1.57,color:[.922,0,.149],number:118}},{}],5:[function(e,t,r){!function(e){"use strict";var t={};void 0===r?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:e:t.exports=r,function(e){if(!B)var B=1e-6;if(!a)var a="undefined"!=typeof Float32Array?Float32Array:Array;if(!s)var s=Math.random;var t={setMatrixArrayType:function(e){a=e}};void 0!==e&&(e.glMatrix=t);var r=Math.PI/180;t.toRadian=function(e){return e*r};var u,n={};n.create=function(){var e=new a(2);return e[0]=0,e[1]=0,e},n.clone=function(e){var t=new a(2);return t[0]=e[0],t[1]=e[1],t},n.fromValues=function(e,t){var r=new a(2);return r[0]=e,r[1]=t,r},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},n.set=function(e,t,r){return e[0]=t,e[1]=r,e},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},n.sub=n.subtract,n.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},n.mul=n.multiply,n.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},n.div=n.divide,n.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},n.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},n.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},n.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},n.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)},n.dist=n.distance,n.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},n.len=n.length,n.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},n.normalize=function(e,t){var r=t[0],n=t[1],o=r*r+n*n;return 0<o&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},n.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},n.lerp=function(e,t,r,n){var o=t[0],a=t[1];return e[0]=o+n*(r[0]-o),e[1]=a+n*(r[1]-a),e},n.random=function(e,t){t=t||1;var r=2*s()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},n.transformMat2=function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e},n.transformMat2d=function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e},n.transformMat3=function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[3]*o+r[6],e[1]=r[1]*n+r[4]*o+r[7],e},n.transformMat4=function(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[4]*o+r[12],e[1]=r[1]*n+r[5]*o+r[13],e},n.forEach=(u=n.create(),function(e,t,r,n,o,a){var s,i;for(t||(t=2),r||(r=0),i=n?Math.min(n*t+r,e.length):e.length,s=r;s<i;s+=t)u[0]=e[s],u[1]=e[s+1],o(u,u,a),e[s]=u[0],e[s+1]=u[1];return e}),n.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},void 0!==e&&(e.vec2=n);var m,i={};i.create=function(){var e=new a(3);return e[0]=0,e[1]=0,e[2]=0,e},i.clone=function(e){var t=new a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.fromValues=function(e,t,r){var n=new a(3);return n[0]=e,n[1]=t,n[2]=r,n},i.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},i.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},i.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},i.sub=i.subtract,i.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},i.mul=i.multiply,i.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},i.div=i.divide,i.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},i.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},i.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},i.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},i.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+n*n+o*o)},i.dist=i.distance,i.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o},i.sqrDist=i.squaredDistance,i.length=function(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)},i.len=i.length,i.squaredLength=function(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n},i.sqrLen=i.squaredLength,i.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},i.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},i.normalize=function(e,t){var r=t[0],n=t[1],o=t[2],a=r*r+n*n+o*o;return 0<a&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i.cross=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=r[0],i=r[1],u=r[2];return e[0]=o*u-a*i,e[1]=a*s-n*u,e[2]=n*i-o*s,e},i.lerp=function(e,t,r,n){var o=t[0],a=t[1],s=t[2];return e[0]=o+n*(r[0]-o),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e},i.random=function(e,t){t=t||1;var r=2*s()*Math.PI,n=2*s()-1,o=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=n*t,e},i.transformMat4=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=r[3]*n+r[7]*o+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*o+r[8]*a+r[12])/s,e[1]=(r[1]*n+r[5]*o+r[9]*a+r[13])/s,e[2]=(r[2]*n+r[6]*o+r[10]*a+r[14])/s,e},i.transformMat3=function(e,t,r){var n=t[0],o=t[1],a=t[2];return e[0]=n*r[0]+o*r[3]+a*r[6],e[1]=n*r[1]+o*r[4]+a*r[7],e[2]=n*r[2]+o*r[5]+a*r[8],e},i.transformQuat=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=r[0],i=r[1],u=r[2],m=r[3],l=m*n+i*a-u*o,c=m*o+u*n-s*a,f=m*a+s*o-i*n,p=-s*n-i*o-u*a;return e[0]=l*m+p*-s+c*-u-f*-i,e[1]=c*m+p*-i+f*-s-l*-u,e[2]=f*m+p*-u+l*-i-c*-s,e},i.rotateX=function(e,t,r,n){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[0],a[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),a[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},i.rotateY=function(e,t,r,n){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),a[1]=o[1],a[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},i.rotateZ=function(e,t,r,n){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),a[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),a[2]=o[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},i.forEach=(m=i.create(),function(e,t,r,n,o,a){var s,i;for(t||(t=3),r||(r=0),i=n?Math.min(n*t+r,e.length):e.length,s=r;s<i;s+=t)m[0]=e[s],m[1]=e[s+1],m[2]=e[s+2],o(m,m,a),e[s]=m[0],e[s+1]=m[1],e[s+2]=m[2];return e}),i.angle=function(e,t){var r=i.fromValues(e[0],e[1],e[2]),n=i.fromValues(t[0],t[1],t[2]);i.normalize(r,r),i.normalize(n,n);var o=i.dot(r,n);return 1<o?0:Math.acos(o)},i.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},void 0!==e&&(e.vec3=i);var l,o={};o.create=function(){var e=new a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},o.clone=function(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.fromValues=function(e,t,r,n){var o=new a(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.set=function(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e},o.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},o.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},o.sub=o.subtract,o.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},o.mul=o.multiply,o.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},o.div=o.divide,o.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},o.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},o.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},o.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},o.distance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+o*o+a*a)},o.dist=o.distance,o.squaredDistance=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+o*o+a*a},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],r=e[1],n=e[2],o=e[3];return Math.sqrt(t*t+r*r+n*n+o*o)},o.len=o.length,o.squaredLength=function(e){var t=e[0],r=e[1],n=e[2],o=e[3];return t*t+r*r+n*n+o*o},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},o.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},o.normalize=function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=r*r+n*n+o*o+a*a;return 0<s&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},o.lerp=function(e,t,r,n){var o=t[0],a=t[1],s=t[2],i=t[3];return e[0]=o+n*(r[0]-o),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=i+n*(r[3]-i),e},o.random=function(e,t){return t=t||1,e[0]=s(),e[1]=s(),e[2]=s(),e[3]=s(),o.normalize(e,e),o.scale(e,e,t),e},o.transformMat4=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3];return e[0]=r[0]*n+r[4]*o+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*o+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*o+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*o+r[11]*a+r[15]*s,e},o.transformQuat=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=r[0],i=r[1],u=r[2],m=r[3],l=m*n+i*a-u*o,c=m*o+u*n-s*a,f=m*a+s*o-i*n,p=-s*n-i*o-u*a;return e[0]=l*m+p*-s+c*-u-f*-i,e[1]=c*m+p*-i+f*-s-l*-u,e[2]=f*m+p*-u+l*-i-c*-s,e},o.forEach=(l=o.create(),function(e,t,r,n,o,a){var s,i;for(t||(t=4),r||(r=0),i=n?Math.min(n*t+r,e.length):e.length,s=r;s<i;s+=t)l[0]=e[s],l[1]=e[s+1],l[2]=e[s+2],l[3]=e[s+3],o(l,l,a),e[s]=l[0],e[s+1]=l[1],e[s+2]=l[2],e[s+3]=l[3];return e}),o.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},void 0!==e&&(e.vec4=o);var c={create:function(){var e=new a(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},clone:function(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=r*a-o*n;return s?(s=1/s,e[0]=a*s,e[1]=-n*s,e[2]=-o*s,e[3]=r*s,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=r[0],u=r[1],m=r[2],l=r[3];return e[0]=n*i+a*u,e[1]=o*i+s*u,e[2]=n*m+a*l,e[3]=o*m+s*l,e}};c.mul=c.multiply,c.rotate=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*i,e[1]=o*u+s*i,e[2]=n*-i+a*u,e[3]=o*-i+s*u,e},c.scale=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=r[0],u=r[1];return e[0]=n*i,e[1]=o*i,e[2]=a*u,e[3]=s*u,e},c.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},c.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},void 0!==e&&(e.mat2=c);var f={create:function(){var e=new a(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},clone:function(e){var t=new a(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=r*a-n*o;return u?(u=1/u,e[0]=a*u,e[1]=-n*u,e[2]=-o*u,e[3]=r*u,e[4]=(o*i-a*s)*u,e[5]=(n*s-r*i)*u,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=r[0],l=r[1],c=r[2],f=r[3],p=r[4],d=r[5];return e[0]=n*m+a*l,e[1]=o*m+s*l,e[2]=n*c+a*f,e[3]=o*c+s*f,e[4]=n*p+a*d+i,e[5]=o*p+s*d+u,e}};f.mul=f.multiply,f.rotate=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*m,e[1]=o*l+s*m,e[2]=n*-m+a*l,e[3]=o*-m+s*l,e[4]=i,e[5]=u,e},f.scale=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=r[0],l=r[1];return e[0]=n*m,e[1]=o*m,e[2]=a*l,e[3]=s*l,e[4]=i,e[5]=u,e},f.translate=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=r[0],l=r[1];return e[0]=n,e[1]=o,e[2]=a,e[3]=s,e[4]=n*m+a*l+i,e[5]=o*m+s*l+u,e},f.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},f.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},void 0!==e&&(e.mat2d=f);var p={create:function(){var e=new a(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new a(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=t[6],m=t[7],l=t[8],c=l*s-i*m,f=-l*a+i*u,p=m*a-s*u,d=r*c+n*f+o*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*n+o*m)*d,e[2]=(i*n-o*s)*d,e[3]=f*d,e[4]=(l*r-o*u)*d,e[5]=(-i*r+o*a)*d,e[6]=p*d,e[7]=(-m*r+n*u)*d,e[8]=(s*r-n*a)*d,e):null},adjoint:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=t[6],m=t[7],l=t[8];return e[0]=s*l-i*m,e[1]=o*m-n*l,e[2]=n*i-o*s,e[3]=i*u-a*l,e[4]=r*l-o*u,e[5]=o*a-r*i,e[6]=a*m-s*u,e[7]=n*u-r*m,e[8]=r*s-n*a,e},determinant:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],i=e[6],u=e[7],m=e[8];return t*(m*a-s*u)+r*(-m*o+s*i)+n*(u*o-a*i)},multiply:function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=t[6],l=t[7],c=t[8],f=r[0],p=r[1],d=r[2],v=r[3],b=r[4],x=r[5],h=r[6],g=r[7],y=r[8];return e[0]=f*n+p*s+d*m,e[1]=f*o+p*i+d*l,e[2]=f*a+p*u+d*c,e[3]=v*n+b*s+x*m,e[4]=v*o+b*i+x*l,e[5]=v*a+b*u+x*c,e[6]=h*n+g*s+y*m,e[7]=h*o+g*i+y*l,e[8]=h*a+g*u+y*c,e}};p.mul=p.multiply,p.translate=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=t[6],l=t[7],c=t[8],f=r[0],p=r[1];return e[0]=n,e[1]=o,e[2]=a,e[3]=s,e[4]=i,e[5]=u,e[6]=f*n+p*s+m,e[7]=f*o+p*i+l,e[8]=f*a+p*u+c,e},p.rotate=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=t[6],l=t[7],c=t[8],f=Math.sin(r),p=Math.cos(r);return e[0]=p*n+f*s,e[1]=p*o+f*i,e[2]=p*a+f*u,e[3]=p*s-f*n,e[4]=p*i-f*o,e[5]=p*u-f*a,e[6]=m,e[7]=l,e[8]=c,e},p.scale=function(e,t,r){var n=r[0],o=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},p.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},p.fromQuat=function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=r+r,i=n+n,u=o+o,m=r*s,l=n*s,c=n*i,f=o*s,p=o*i,d=o*u,v=a*s,b=a*i,x=a*u;return e[0]=1-c-d,e[3]=l-x,e[6]=f+b,e[1]=l+x,e[4]=1-m-d,e[7]=p-v,e[2]=f-b,e[5]=p+v,e[8]=1-m-c,e},p.normalFromMat4=function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=t[6],m=t[7],l=t[8],c=t[9],f=t[10],p=t[11],d=t[12],v=t[13],b=t[14],x=t[15],h=r*i-n*s,g=r*u-o*s,y=r*m-a*s,M=n*u-o*i,R=n*m-a*i,A=o*m-a*u,S=l*v-c*d,U=l*b-f*d,T=l*x-p*d,_=c*b-f*v,w=c*x-p*v,E=f*x-p*b,D=h*E-g*w+y*_+M*T-R*U+A*S;return D?(D=1/D,e[0]=(i*E-u*w+m*_)*D,e[1]=(u*T-s*E-m*U)*D,e[2]=(s*w-i*T+m*S)*D,e[3]=(o*w-n*E-a*_)*D,e[4]=(r*E-o*T+a*U)*D,e[5]=(n*T-r*w-a*S)*D,e[6]=(v*A-b*R+x*M)*D,e[7]=(b*y-d*A-x*g)*D,e[8]=(d*R-v*y+x*h)*D,e):null},p.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},p.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},void 0!==e&&(e.mat3=p);var A={create:function(){var e=new a(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],o=t[3],a=t[6],s=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=o,e[13]=s,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=t[6],m=t[7],l=t[8],c=t[9],f=t[10],p=t[11],d=t[12],v=t[13],b=t[14],x=t[15],h=r*i-n*s,g=r*u-o*s,y=r*m-a*s,M=n*u-o*i,R=n*m-a*i,A=o*m-a*u,S=l*v-c*d,U=l*b-f*d,T=l*x-p*d,_=c*b-f*v,w=c*x-p*v,E=f*x-p*b,D=h*E-g*w+y*_+M*T-R*U+A*S;return D?(D=1/D,e[0]=(i*E-u*w+m*_)*D,e[1]=(o*w-n*E-a*_)*D,e[2]=(v*A-b*R+x*M)*D,e[3]=(f*R-c*A-p*M)*D,e[4]=(u*T-s*E-m*U)*D,e[5]=(r*E-o*T+a*U)*D,e[6]=(b*y-d*A-x*g)*D,e[7]=(l*A-f*y+p*g)*D,e[8]=(s*w-i*T+m*S)*D,e[9]=(n*T-r*w-a*S)*D,e[10]=(d*R-v*y+x*h)*D,e[11]=(c*y-l*R-p*h)*D,e[12]=(i*U-s*_-u*S)*D,e[13]=(r*_-n*U+o*S)*D,e[14]=(v*g-d*M-b*h)*D,e[15]=(l*M-c*g+f*h)*D,e):null},adjoint:function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],i=t[5],u=t[6],m=t[7],l=t[8],c=t[9],f=t[10],p=t[11],d=t[12],v=t[13],b=t[14],x=t[15];return e[0]=i*(f*x-p*b)-c*(u*x-m*b)+v*(u*p-m*f),e[1]=-(n*(f*x-p*b)-c*(o*x-a*b)+v*(o*p-a*f)),e[2]=n*(u*x-m*b)-i*(o*x-a*b)+v*(o*m-a*u),e[3]=-(n*(u*p-m*f)-i*(o*p-a*f)+c*(o*m-a*u)),e[4]=-(s*(f*x-p*b)-l*(u*x-m*b)+d*(u*p-m*f)),e[5]=r*(f*x-p*b)-l*(o*x-a*b)+d*(o*p-a*f),e[6]=-(r*(u*x-m*b)-s*(o*x-a*b)+d*(o*m-a*u)),e[7]=r*(u*p-m*f)-s*(o*p-a*f)+l*(o*m-a*u),e[8]=s*(c*x-p*v)-l*(i*x-m*v)+d*(i*p-m*c),e[9]=-(r*(c*x-p*v)-l*(n*x-a*v)+d*(n*p-a*c)),e[10]=r*(i*x-m*v)-s*(n*x-a*v)+d*(n*m-a*i),e[11]=-(r*(i*p-m*c)-s*(n*p-a*c)+l*(n*m-a*i)),e[12]=-(s*(c*b-f*v)-l*(i*b-u*v)+d*(i*f-u*c)),e[13]=r*(c*b-f*v)-l*(n*b-o*v)+d*(n*f-o*c),e[14]=-(r*(i*b-u*v)-s*(n*b-o*v)+d*(n*u-o*i)),e[15]=r*(i*f-u*c)-s*(n*f-o*c)+l*(n*u-o*i),e},determinant:function(e){var t=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],i=e[6],u=e[7],m=e[8],l=e[9],c=e[10],f=e[11],p=e[12],d=e[13],v=e[14],b=e[15];return(t*s-r*a)*(c*b-f*v)-(t*i-n*a)*(l*b-f*d)+(t*u-o*a)*(l*v-c*d)+(r*i-n*s)*(m*b-f*p)-(r*u-o*s)*(m*v-c*p)+(n*u-o*i)*(m*d-l*p)},multiply:function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=t[6],l=t[7],c=t[8],f=t[9],p=t[10],d=t[11],v=t[12],b=t[13],x=t[14],h=t[15],g=r[0],y=r[1],M=r[2],R=r[3];return e[0]=g*n+y*i+M*c+R*v,e[1]=g*o+y*u+M*f+R*b,e[2]=g*a+y*m+M*p+R*x,e[3]=g*s+y*l+M*d+R*h,g=r[4],y=r[5],M=r[6],R=r[7],e[4]=g*n+y*i+M*c+R*v,e[5]=g*o+y*u+M*f+R*b,e[6]=g*a+y*m+M*p+R*x,e[7]=g*s+y*l+M*d+R*h,g=r[8],y=r[9],M=r[10],R=r[11],e[8]=g*n+y*i+M*c+R*v,e[9]=g*o+y*u+M*f+R*b,e[10]=g*a+y*m+M*p+R*x,e[11]=g*s+y*l+M*d+R*h,g=r[12],y=r[13],M=r[14],R=r[15],e[12]=g*n+y*i+M*c+R*v,e[13]=g*o+y*u+M*f+R*b,e[14]=g*a+y*m+M*p+R*x,e[15]=g*s+y*l+M*d+R*h,e}};A.mul=A.multiply,A.translate=function(e,t,r){var n,o,a,s,i,u,m,l,c,f,p,d,v=r[0],b=r[1],x=r[2];return t===e?(e[12]=t[0]*v+t[4]*b+t[8]*x+t[12],e[13]=t[1]*v+t[5]*b+t[9]*x+t[13],e[14]=t[2]*v+t[6]*b+t[10]*x+t[14],e[15]=t[3]*v+t[7]*b+t[11]*x+t[15]):(n=t[0],o=t[1],a=t[2],s=t[3],i=t[4],u=t[5],m=t[6],l=t[7],c=t[8],f=t[9],p=t[10],d=t[11],e[0]=n,e[1]=o,e[2]=a,e[3]=s,e[4]=i,e[5]=u,e[6]=m,e[7]=l,e[8]=c,e[9]=f,e[10]=p,e[11]=d,e[12]=n*v+i*b+c*x+t[12],e[13]=o*v+u*b+f*x+t[13],e[14]=a*v+m*b+p*x+t[14],e[15]=s*v+l*b+d*x+t[15]),e},A.scale=function(e,t,r){var n=r[0],o=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},A.rotate=function(e,t,r,n){var o,a,s,i,u,m,l,c,f,p,d,v,b,x,h,g,y,M,R,A,S,U,T,_,w=n[0],E=n[1],D=n[2],F=Math.sqrt(w*w+E*E+D*D);return Math.abs(F)<B?null:(w*=F=1/F,E*=F,D*=F,o=Math.sin(r),s=1-(a=Math.cos(r)),i=t[0],u=t[1],m=t[2],l=t[3],c=t[4],f=t[5],p=t[6],d=t[7],v=t[8],b=t[9],x=t[10],h=t[11],g=w*w*s+a,y=E*w*s+D*o,M=D*w*s-E*o,R=w*E*s-D*o,A=E*E*s+a,S=D*E*s+w*o,U=w*D*s+E*o,T=E*D*s-w*o,_=D*D*s+a,e[0]=i*g+c*y+v*M,e[1]=u*g+f*y+b*M,e[2]=m*g+p*y+x*M,e[3]=l*g+d*y+h*M,e[4]=i*R+c*A+v*S,e[5]=u*R+f*A+b*S,e[6]=m*R+p*A+x*S,e[7]=l*R+d*A+h*S,e[8]=i*U+c*T+v*_,e[9]=u*U+f*T+b*_,e[10]=m*U+p*T+x*_,e[11]=l*U+d*T+h*_,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},A.rotateX=function(e,t,r){var n=Math.sin(r),o=Math.cos(r),a=t[4],s=t[5],i=t[6],u=t[7],m=t[8],l=t[9],c=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+m*n,e[5]=s*o+l*n,e[6]=i*o+c*n,e[7]=u*o+f*n,e[8]=m*o-a*n,e[9]=l*o-s*n,e[10]=c*o-i*n,e[11]=f*o-u*n,e},A.rotateY=function(e,t,r){var n=Math.sin(r),o=Math.cos(r),a=t[0],s=t[1],i=t[2],u=t[3],m=t[8],l=t[9],c=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-m*n,e[1]=s*o-l*n,e[2]=i*o-c*n,e[3]=u*o-f*n,e[8]=a*n+m*o,e[9]=s*n+l*o,e[10]=i*n+c*o,e[11]=u*n+f*o,e},A.rotateZ=function(e,t,r){var n=Math.sin(r),o=Math.cos(r),a=t[0],s=t[1],i=t[2],u=t[3],m=t[4],l=t[5],c=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+m*n,e[1]=s*o+l*n,e[2]=i*o+c*n,e[3]=u*o+f*n,e[4]=m*o-a*n,e[5]=l*o-s*n,e[6]=c*o-i*n,e[7]=f*o-u*n,e},A.fromRotationTranslation=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=n+n,u=o+o,m=a+a,l=n*i,c=n*u,f=n*m,p=o*u,d=o*m,v=a*m,b=s*i,x=s*u,h=s*m;return e[0]=1-(p+v),e[1]=c+h,e[2]=f-x,e[3]=0,e[4]=c-h,e[5]=1-(l+v),e[6]=d+b,e[7]=0,e[8]=f+x,e[9]=d-b,e[10]=1-(l+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},A.fromQuat=function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=r+r,i=n+n,u=o+o,m=r*s,l=n*s,c=n*i,f=o*s,p=o*i,d=o*u,v=a*s,b=a*i,x=a*u;return e[0]=1-c-d,e[1]=l+x,e[2]=f-b,e[3]=0,e[4]=l-x,e[5]=1-m-d,e[6]=p+v,e[7]=0,e[8]=f+b,e[9]=p-v,e[10]=1-m-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},A.frustum=function(e,t,r,n,o,a,s){var i=1/(r-t),u=1/(o-n),m=1/(a-s);return e[0]=2*a*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(r+t)*i,e[9]=(o+n)*u,e[10]=(s+a)*m,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*m,e[15]=0,e},A.perspective=function(e,t,r,n,o){var a=1/Math.tan(t/2),s=1/(n-o);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+n)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*n*s,e[15]=0,e},A.ortho=function(e,t,r,n,o,a,s){var i=1/(t-r),u=1/(n-o),m=1/(a-s);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*m,e[11]=0,e[12]=(t+r)*i,e[13]=(o+n)*u,e[14]=(s+a)*m,e[15]=1,e},A.lookAt=function(e,t,r,n){var o,a,s,i,u,m,l,c,f,p,d=t[0],v=t[1],b=t[2],x=n[0],h=n[1],g=n[2],y=r[0],M=r[1],R=r[2];return Math.abs(d-y)<B&&Math.abs(v-M)<B&&Math.abs(b-R)<B?A.identity(e):(l=d-y,c=v-M,f=b-R,o=h*(f*=p=1/Math.sqrt(l*l+c*c+f*f))-g*(c*=p),a=g*(l*=p)-x*f,s=x*c-h*l,(p=Math.sqrt(o*o+a*a+s*s))?(o*=p=1/p,a*=p,s*=p):s=a=o=0,i=c*s-f*a,u=f*o-l*s,m=l*a-c*o,(p=Math.sqrt(i*i+u*u+m*m))?(i*=p=1/p,u*=p,m*=p):m=u=i=0,e[0]=o,e[1]=i,e[2]=l,e[3]=0,e[4]=a,e[5]=u,e[6]=c,e[7]=0,e[8]=s,e[9]=m,e[10]=f,e[11]=0,e[12]=-(o*d+a*v+s*b),e[13]=-(i*d+u*v+m*b),e[14]=-(l*d+c*v+f*b),e[15]=1,e)},A.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},A.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},void 0!==e&&(e.mat4=A);var d,v,b,x,h={};h.create=function(){var e=new a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.rotationTo=(d=i.create(),v=i.fromValues(1,0,0),b=i.fromValues(0,1,0),function(e,t,r){var n=i.dot(t,r);return n<-.999999?(i.cross(d,v,t),i.length(d)<1e-6&&i.cross(d,b,t),i.normalize(d,d),h.setAxisAngle(e,d,Math.PI),e):.999999<n?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.cross(d,t,r),e[0]=d[0],e[1]=d[1],e[2]=d[2],e[3]=1+n,h.normalize(e,e))}),h.setAxes=(x=p.create(),function(e,t,r,n){return x[0]=r[0],x[3]=r[1],x[6]=r[2],x[1]=n[0],x[4]=n[1],x[7]=n[2],x[2]=-t[0],x[5]=-t[1],x[8]=-t[2],h.normalize(e,h.fromMat3(e,x))}),h.clone=o.clone,h.fromValues=o.fromValues,h.copy=o.copy,h.set=o.set,h.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.setAxisAngle=function(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e},h.add=o.add,h.multiply=function(e,t,r){var n=t[0],o=t[1],a=t[2],s=t[3],i=r[0],u=r[1],m=r[2],l=r[3];return e[0]=n*l+s*i+o*m-a*u,e[1]=o*l+s*u+a*i-n*m,e[2]=a*l+s*m+n*u-o*i,e[3]=s*l-n*i-o*u-a*m,e},h.mul=h.multiply,h.scale=o.scale,h.rotateX=function(e,t,r){r*=.5;var n=t[0],o=t[1],a=t[2],s=t[3],i=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*i,e[1]=o*u+a*i,e[2]=a*u-o*i,e[3]=s*u-n*i,e},h.rotateY=function(e,t,r){r*=.5;var n=t[0],o=t[1],a=t[2],s=t[3],i=Math.sin(r),u=Math.cos(r);return e[0]=n*u-a*i,e[1]=o*u+s*i,e[2]=a*u+n*i,e[3]=s*u-o*i,e},h.rotateZ=function(e,t,r){r*=.5;var n=t[0],o=t[1],a=t[2],s=t[3],i=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*i,e[1]=o*u-n*i,e[2]=a*u+s*i,e[3]=s*u-a*i,e},h.calculateW=function(e,t){var r=t[0],n=t[1],o=t[2];return e[0]=r,e[1]=n,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-o*o)),e},h.dot=o.dot,h.lerp=o.lerp,h.slerp=function(e,t,r,n){var o,a,s,i,u,m=t[0],l=t[1],c=t[2],f=t[3],p=r[0],d=r[1],v=r[2],b=r[3];return(a=m*p+l*d+c*v+f*b)<0&&(a=-a,p=-p,d=-d,v=-v,b=-b),1e-6<1-a?(o=Math.acos(a),s=Math.sin(o),i=Math.sin((1-n)*o)/s,u=Math.sin(n*o)/s):(i=1-n,u=n),e[0]=i*m+u*p,e[1]=i*l+u*d,e[2]=i*c+u*v,e[3]=i*f+u*b,e},h.invert=function(e,t){var r=t[0],n=t[1],o=t[2],a=t[3],s=r*r+n*n+o*o+a*a,i=s?1/s:0;return e[0]=-r*i,e[1]=-n*i,e[2]=-o*i,e[3]=a*i,e},h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.length=o.length,h.len=h.length,h.squaredLength=o.squaredLength,h.sqrLen=h.squaredLength,h.normalize=o.normalize,h.fromMat3=function(e,t){var r,n=t[0]+t[4]+t[8];if(0<n)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var a=(o+1)%3,s=(o+2)%3;r=Math.sqrt(t[3*o+o]-t[3*a+a]-t[3*s+s]+1),e[o]=.5*r,r=.5/r,e[3]=(t[3*a+s]-t[3*s+a])*r,e[a]=(t[3*a+o]+t[3*o+a])*r,e[s]=(t[3*s+o]+t[3*o+s])*r}return e},h.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},void 0!==e&&(e.quat=h)}(t.exports)}(this)},{}],6:[function(e,t,r){"use strict";var X=e("./gl-matrix"),V=e("./webgl.js"),H=e("./cube"),G=e("./elements"),W=e("./view"),j=e("./system");function k(e,t){return t=t.split("// __split__"),new V.Program(e,t[0],t[1])}t.exports=function(n,f,p){var d,g,y,r,v,b,x,e,h,o,a,t,s,i,u,m,M,R,l,c,A,S,U,T,_,w,E,D=this,F=null,B=null,P=null,C=null,z=null,I=null,L=0,N=!1,O=!1;function q(e){y.viewport(0,0,p,p);var t=W.clone(e);t.zoom=1/d,t.translation.x=0,t.translation.y=0;for(var r=X.mat4.create(),n=0;n<3;n++){var o=X.vec3.random(X.vec3.create(),1);X.mat4.rotate(r,r,10*Math.random(),o)}t.rotation=X.mat4.multiply(X.mat4.create(),r,t.rotation),M.bind(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);var a=W.getRect(t),s=X.mat4.create();X.mat4.ortho(s,a.left,a.right,a.bottom,a.top,0,d);var i=X.mat4.create();X.mat4.lookAt(i,[0,0,0],[0,0,-1],[0,1,0]);var u=X.mat4.create();X.mat4.translate(u,u,[0,0,-d/2]),X.mat4.multiply(u,u,t.rotation),A.setUniform("uProjection","Matrix4fv",!1,s),A.setUniform("uView","Matrix4fv",!1,i),A.setUniform("uModel","Matrix4fv",!1,u),A.setUniform("uBottomLeft","2fv",[a.left,a.bottom]),A.setUniform("uTopRight","2fv",[a.right,a.top]),A.setUniform("uAtomScale","1f",2.5*t.atomScale),A.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),A.setUniform("uRes","1f",p),A.setUniform("uDepth","1f",d),A.setUniform("uMode","1i",0),A.setUniform("uAtomShade","1f",e.atomShade),F.render(),e.bonds&&null!=B&&(S.setUniform("uProjection","Matrix4fv",!1,s),S.setUniform("uView","Matrix4fv",!1,i),S.setUniform("uModel","Matrix4fv",!1,u),S.setUniform("uRotation","Matrix4fv",!1,t.rotation),S.setUniform("uDepth","1f",d),S.setUniform("uBottomLeft","2fv",[a.left,a.bottom]),S.setUniform("uTopRight","2fv",[a.right,a.top]),S.setUniform("uRes","1f",p),S.setUniform("uBondRadius","1f",2.5*W.getBondRadius(e)),S.setUniform("uBondShade","1f",e.bondShade),S.setUniform("uAtomScale","1f",2.5*e.atomScale),S.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),S.setUniform("uMode","1i",0),B.render()),y.viewport(0,0,f,f);var m=W.getRect(e),l=W.getRect(t),c=X.mat4.invert(X.mat4.create(),r);R.bind(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),U.setUniform("uSceneDepth","1i",b.index),U.setUniform("uSceneNormal","1i",v.index),U.setUniform("uRandRotDepth","1i",x.index),U.setUniform("uAccumulator","1i",h.index),U.setUniform("uSceneBottomLeft","2fv",[m.left,m.bottom]),U.setUniform("uSceneTopRight","2fv",[m.right,m.top]),U.setUniform("uRotBottomLeft","2fv",[l.left,l.bottom]),U.setUniform("uRotTopRight","2fv",[l.right,l.top]),U.setUniform("uRes","1f",f),U.setUniform("uDepth","1f",d),U.setUniform("uRot","Matrix4fv",!1,r),U.setUniform("uInvRot","Matrix4fv",!1,c),U.setUniform("uSampleCount","1i",L),P.render(),h.activate(),h.bind(),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,f,f,0)}D.getAOProgress=function(){return L/1024},D.initialize=function(){n.width=n.height=f,(y=n.getContext("webgl")).enable(y.DEPTH_TEST),y.enable(y.CULL_FACE),y.clearColor(0,0,0,0),y.clearDepth(1),y.viewport(0,0,f,f),window.gl=y,V.getExtensions(y,["EXT_frag_depth","WEBGL_depth_texture"]),D.createTextures(),A=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aImposter;\nattribute vec3 aPosition;\nattribute float aRadius;\nattribute vec3 aColor;\n\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform mat4 uModel;\nuniform float uAtomScale;\nuniform float uRelativeAtomScale;\nuniform float uAtomShade;\n\nvarying vec3 vColor;\nvarying vec3 vPosition;\nvarying float vRadius;\n\nvoid main() {\n    vRadius = uAtomScale * (1.0 + (aRadius - 1.0) * uRelativeAtomScale);\n    gl_Position = uProjection * uView * uModel * vec4(vRadius * aImposter + aPosition, 1.0);\n    vColor = mix(aColor, vec3(1,1,1), uAtomShade);\n    vPosition = vec3(uModel * vec4(aPosition, 1));\n}\n\n\n// __split__\n\n\n#version 100\n#extension GL_EXT_frag_depth: enable\nprecision highp float;\n\nuniform vec2 uBottomLeft;\nuniform vec2 uTopRight;\nuniform float uRes;\nuniform float uDepth;\nuniform int uMode;\n\nvarying vec3 vPosition;\nvarying float vRadius;\nvarying vec3 vColor;\n\nvec2 res = vec2(uRes, uRes);\n\nfloat raySphereIntersect(vec3 r0, vec3 rd) {\n    float a = dot(rd, rd);\n    vec3 s0_r0 = r0 - vPosition;\n    float b = 2.0 * dot(rd, s0_r0);\n    float c = dot(s0_r0, s0_r0) - (vRadius * vRadius);\n    float disc = b*b - 4.0*a*c;\n    if (disc <= 0.0) {\n        return -1.0;\n    }\n    return (-b - sqrt(disc))/(2.0*a);\n}\n\nvoid main() {\n    vec3 r0 = vec3(uBottomLeft + (gl_FragCoord.xy/res) * (uTopRight - uBottomLeft), 0.0);\n    vec3 rd = vec3(0, 0, -1);\n    float t = raySphereIntersect(r0, rd);\n    if (t < 0.0) {\n        discard;\n    }\n    vec3 coord = r0 + rd * t;\n    vec3 normal = normalize(coord - vPosition);\n    if (uMode == 0) {\n        gl_FragColor = vec4(vColor, 1);\n    } else if (uMode == 1) {\n        gl_FragColor = vec4(normal * 0.5 + 0.5, 1.0);\n    }\n    gl_FragDepthEXT = -coord.z/uDepth;\n}\n"),S=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aImposter;\nattribute vec3 aPosA;\nattribute vec3 aPosB;\nattribute float aRadA;\nattribute float aRadB;\nattribute vec3 aColA;\nattribute vec3 aColB;\n\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform mat4 uModel;\nuniform mat4 uRotation;\nuniform float uBondRadius;\nuniform float uAtomScale;\nuniform float uRelativeAtomScale;\n\nvarying vec3 vNormal;\nvarying vec3 vPosA, vPosB;\nvarying float vRadA, vRadB;\nvarying vec3 vColA, vColB;\nvarying float vRadius;\n\nmat3 alignVector(vec3 a, vec3 b) {\n    vec3 v = cross(a, b);\n    float s = length(v);\n    float c = dot(a, b);\n    mat3 I = mat3(\n        1, 0, 0,\n        0, 1, 0,\n        0, 0, 1\n    );\n    mat3 vx = mat3(\n        0, v.z, -v.y,\n        -v.z, 0, v.x,\n        v.y, -v.x, 0\n    );\n    return I + vx + vx * vx * ((1.0 - c) / (s * s));\n}\n\nvoid main() {\n    vRadius = uBondRadius;\n    vec3 pos = vec3(aImposter);\n    // Scale the box in x and z to be bond-radius.\n    pos = pos * vec3(vRadius, 1, vRadius);\n    // Shift the origin-centered cube so that the bottom is at the origin.\n    pos = pos + vec3(0, 1, 0);\n    // Stretch the box in y so that it is the length of the bond.\n    pos = pos * vec3(1, length(aPosA - aPosB) * 0.5, 1);\n    // Find the rotation that aligns vec3(0, 1, 0) with vec3(uPosB - uPosA) and apply it.\n    vec3 a = normalize(vec3(-0.000001, 1.000001, 0.000001));\n    vec3 b = normalize(aPosB - aPosA);\n    mat3 R = alignVector(a, b);\n    pos = R * pos;\n    // Shift the cube so that the bottom is centered at the middle of atom A.\n    pos = pos + aPosA;\n\n    vec4 position = uModel * vec4(pos, 1);\n    gl_Position = uProjection * uView * position;\n    vPosA = aPosA;\n    vPosB = aPosB;\n    vRadA = uAtomScale * (1.0 + (aRadA - 1.0) * uRelativeAtomScale);\n    vRadB = uAtomScale * (1.0 + (aRadB - 1.0) * uRelativeAtomScale);\n    vColA = aColA;\n    vColB = aColB;\n}\n\n\n// __split__\n\n\n#version 100\n#extension GL_EXT_frag_depth: enable\nprecision highp float;\n\nuniform mat4 uRotation;\nuniform vec2 uBottomLeft;\nuniform vec2 uTopRight;\nuniform float uDepth;\nuniform float uRes;\nuniform float uBondShade;\nuniform int uMode;\n\nvarying vec3 vPosA, vPosB;\nvarying float vRadA, vRadB;\nvarying vec3 vColA, vColB;\nvarying float vRadius;\n\nmat3 alignVector(vec3 a, vec3 b) {\n    vec3 v = cross(a, b);\n    float s = length(v);\n    float c = dot(a, b);\n    mat3 I = mat3(\n        1, 0, 0,\n        0, 1, 0,\n        0, 0, 1\n    );\n    mat3 vx = mat3(\n        0, v.z, -v.y,\n        -v.z, 0, v.x,\n        v.y, -v.x, 0\n    );\n    return I + vx + vx * vx * ((1.0 - c) / (s * s));\n}\n\nvoid main() {\n\n    vec2 res = vec2(uRes, uRes);\n    vec3 r0 = vec3(uBottomLeft + (gl_FragCoord.xy/res) * (uTopRight - uBottomLeft), uDepth/2.0);\n    vec3 rd = vec3(0, 0, -1);\n\n    vec3 i = normalize(vPosB - vPosA);\n         i = vec3(uRotation * vec4(i, 0));\n    vec3 j = normalize(vec3(-0.000001, 1.000001, 0.000001));\n    mat3 R = alignVector(i, j);\n\n    vec3 r0p = r0 - vec3(uRotation * vec4(vPosA, 0));\n    r0p = R * r0p;\n    vec3 rdp = R * rd;\n\n    float a = dot(rdp.xz, rdp.xz);\n    float b = 2.0 * dot(rdp.xz, r0p.xz);\n    float c = dot(r0p.xz, r0p.xz) - vRadius*vRadius;\n    float disc = b*b - 4.0*a*c;\n    if (disc <= 0.0) {\n        discard;\n    }\n    float t = (-b - sqrt(disc))/(2.0*a);\n    if (t < 0.0) {\n        discard;\n    }\n\n    vec3 coord = r0p + rdp * t;\n    if (coord.y < 0.0 || coord.y > length(vPosA - vPosB)) {\n        discard;\n    }\n\n    vec3 color;\n    if (coord.y < vRadA + 0.5 * (length(vPosA - vPosB) - (vRadA + vRadB))) {\n        color = vColA;\n    } else {\n        color = vColB;\n    }\n\n    color = mix(color, vec3(1,1,1), uBondShade);\n\n    R = alignVector(j, i);\n    vec3 normal = normalize(R * vec3(coord.x, 0, coord.z));\n\n    coord = r0 + rd * t;\n    if (uMode == 0) {\n        gl_FragColor = vec4(color, 1);\n    } else if (uMode == 1) {\n        gl_FragColor = vec4(normal * 0.5 + 0.5, 1.0);\n    }\n    gl_FragDepthEXT = -(coord.z - uDepth/2.0)/uDepth;\n}\n"),E=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1);\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uTexture;\nuniform float uRes;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, gl_FragCoord.xy/uRes);\n}\n"),U=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1);\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uSceneDepth;\nuniform sampler2D uSceneNormal;\nuniform sampler2D uRandRotDepth;\nuniform sampler2D uAccumulator;\nuniform mat4 uRot;\nuniform mat4 uInvRot;\nuniform vec2 uSceneBottomLeft;\nuniform vec2 uSceneTopRight;\nuniform vec2 uRotBottomLeft;\nuniform vec2 uRotTopRight;\nuniform float uDepth;\nuniform float uRes;\nuniform int uSampleCount;\n\nvoid main() {\n\n    float dScene = texture2D(uSceneDepth, gl_FragCoord.xy/uRes).r;\n\n    vec3 r = vec3(uSceneBottomLeft + (gl_FragCoord.xy/uRes) * (uSceneTopRight - uSceneBottomLeft), 0.0);\n\n    r.z = -(dScene - 0.5) * uDepth;\n    r = vec3(uRot * vec4(r, 1));\n    float depth = -r.z/uDepth + 0.5;\n\n    vec2 p = (r.xy - uRotBottomLeft)/(uRotTopRight - uRotBottomLeft);\n\n    float dRandRot = texture2D(uRandRotDepth, p).r;\n\n    float ao = step(dRandRot, depth * 0.99);\n\n    vec3 normal = texture2D(uSceneNormal, gl_FragCoord.xy/uRes).rgb * 2.0 - 1.0;\n    vec3 dir = vec3(uInvRot * vec4(0, 0, 1, 0));\n    float mag = dot(dir, normal);\n    float sampled = step(0.0, mag);\n\n    ao *= sampled;\n\n    vec4 acc = texture2D(uAccumulator, gl_FragCoord.xy/uRes);\n\n    if (uSampleCount < 256) {\n        acc.r += ao/255.0;\n    } else if (uSampleCount < 512) {\n        acc.g += ao/255.0;\n    } else if (uSampleCount < 768) {\n        acc.b += ao/255.0;\n    } else {\n        acc.a += ao/255.0;\n    }\n        \n    gl_FragColor = acc;\n\n}\n"),T=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1);\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uSceneColor;\nuniform sampler2D uSceneDepth;\nuniform sampler2D uAccumulatorOut;\nuniform float uRes;\nuniform float uAO;\nuniform float uBrightness;\nuniform float uOutlineStrength;\n\nvoid main() {\n    vec2 p = gl_FragCoord.xy/uRes;\n    vec4 sceneColor = texture2D(uSceneColor, p);\n    if (uOutlineStrength > 0.0) {\n        float depth = texture2D(uSceneDepth, p).r;\n        float r = 1.0/511.0;\n        float d0 = abs(texture2D(uSceneDepth, p + vec2(-r,  0)).r - depth);\n        float d1 = abs(texture2D(uSceneDepth, p + vec2( r,  0)).r - depth);\n        float d2 = abs(texture2D(uSceneDepth, p + vec2( 0, -r)).r - depth);\n        float d3 = abs(texture2D(uSceneDepth, p + vec2( 0,  r)).r - depth);\n        float d = max(d0, d1);\n        d = max(d, d2);\n        d = max(d, d3);\n        sceneColor.rgb *= pow(1.0 - d, uOutlineStrength * 32.0);\n        sceneColor.a = max(step(0.003, d), sceneColor.a);\n    }\n    vec4 dAccum = texture2D(uAccumulatorOut, p);\n    float shade = max(0.0, 1.0 - (dAccum.r + dAccum.g + dAccum.b + dAccum.a) * 0.25 * uAO);\n    shade = pow(shade, 2.0);\n    gl_FragColor = vec4(uBrightness * sceneColor.rgb * shade, sceneColor.a);\n}\n"),_=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1);\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uTexture;\nuniform float uRes;\n\nvoid main() {\n    float FXAA_SPAN_MAX = 8.0;\n    float FXAA_REDUCE_MUL = 1.0/8.0;\n    float FXAA_REDUCE_MIN = 1.0/128.0;\n\n    vec2 texCoords = gl_FragCoord.xy/uRes;\n\n    vec4 rgbNW = texture2D(uTexture, texCoords + (vec2(-1.0, -1.0) / uRes));\n    vec4 rgbNE = texture2D(uTexture, texCoords + (vec2(1.0, -1.0) / uRes));\n    vec4 rgbSW = texture2D(uTexture, texCoords + (vec2(-1.0, 1.0) / uRes));\n    vec4 rgbSE = texture2D(uTexture, texCoords + (vec2(1.0, 1.0) / uRes));\n    vec4 rgbM  = texture2D(uTexture, texCoords);\n\n    vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) / uRes;\n\n    vec4 rgbA = (1.0/2.0) * \n        (texture2D(uTexture, texCoords.xy + dir * (1.0/3.0 - 0.5)) + \n         texture2D(uTexture, texCoords.xy + dir * (2.0/3.0 - 0.5)));\n    vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * \n        (texture2D(uTexture, texCoords.xy + dir * (0.0/3.0 - 0.5)) +\n         texture2D(uTexture, texCoords.xy + dir * (3.0/3.0 - 0.5)));\n    float lumaB = dot(rgbB, luma);\n\n    if((lumaB < lumaMin) || (lumaB > lumaMax)){\n        gl_FragColor = rgbA;\n    } else {\n        gl_FragColor = rgbB;\n    }\n\n}"),w=k(y,"#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1);\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uColor;\nuniform sampler2D uDepth;\nuniform float uRes;\nuniform float uDOFPosition;\nuniform float uDOFStrength;\nuniform int leftRight;\n\nvoid main() {\n\n    vec2 samples[64];\n    samples[0] = vec2(0.857612, 0.019885);\n    samples[1] = vec2(0.563809, -0.028071);\n    samples[2] = vec2(0.825599, -0.346856);\n    samples[3] = vec2(0.126584, -0.380959);\n    samples[4] = vec2(0.782948, 0.594322);\n    samples[5] = vec2(0.292148, -0.543265);\n    samples[6] = vec2(0.130700, 0.330220);\n    samples[7] = vec2(0.236088, 0.159604);\n    samples[8] = vec2(-0.305259, 0.810505);\n    samples[9] = vec2(0.269616, 0.923026);\n    samples[10] = vec2(0.484486, 0.371845);\n    samples[11] = vec2(-0.638057, 0.080447);\n    samples[12] = vec2(0.199629, 0.667280);\n    samples[13] = vec2(-0.861043, -0.370583);\n    samples[14] = vec2(-0.040652, -0.996174);\n    samples[15] = vec2(0.330458, -0.282111);\n    samples[16] = vec2(0.647795, -0.214354);\n    samples[17] = vec2(0.030422, -0.189908);\n    samples[18] = vec2(0.177430, -0.721124);\n    samples[19] = vec2(-0.461163, -0.327434);\n    samples[20] = vec2(-0.410012, -0.734504);\n    samples[21] = vec2(-0.616334, -0.626069);\n    samples[22] = vec2(0.590759, -0.726479);\n    samples[23] = vec2(-0.590794, 0.805365);\n    samples[24] = vec2(-0.924561, -0.163739);\n    samples[25] = vec2(-0.323028, 0.526960);\n    samples[26] = vec2(0.642128, 0.752577);\n    samples[27] = vec2(0.173625, -0.952386);\n    samples[28] = vec2(0.759014, 0.330311);\n    samples[29] = vec2(-0.360526, -0.032013);\n    samples[30] = vec2(-0.035320, 0.968156);\n    samples[31] = vec2(0.585478, -0.431068);\n    samples[32] = vec2(-0.244766, -0.906947);\n    samples[33] = vec2(-0.853096, 0.184615);\n    samples[34] = vec2(-0.089061, 0.104648);\n    samples[35] = vec2(-0.437613, 0.285308);\n    samples[36] = vec2(-0.654098, 0.379841);\n    samples[37] = vec2(-0.128663, 0.456572);\n    samples[38] = vec2(0.015980, -0.568170);\n    samples[39] = vec2(-0.043966, -0.771940);\n    samples[40] = vec2(0.346512, -0.071238);\n    samples[41] = vec2(-0.207921, -0.209121);\n    samples[42] = vec2(-0.624075, -0.189224);\n    samples[43] = vec2(-0.120618, 0.689339);\n    samples[44] = vec2(-0.664679, -0.410200);\n    samples[45] = vec2(0.371945, -0.880573);\n    samples[46] = vec2(-0.743251, 0.629998);\n    samples[47] = vec2(-0.191926, -0.413946);\n    samples[48] = vec2(0.449574, 0.833373);\n    samples[49] = vec2(0.299587, 0.449113);\n    samples[50] = vec2(-0.900432, 0.399319);\n    samples[51] = vec2(0.762613, -0.544796);\n    samples[52] = vec2(0.606462, 0.174233);\n    samples[53] = vec2(0.962185, -0.167019);\n    samples[54] = vec2(0.960990, 0.249552);\n    samples[55] = vec2(0.570397, 0.559146);\n    samples[56] = vec2(-0.537514, 0.555019);\n    samples[57] = vec2(0.108491, -0.003232);\n    samples[58] = vec2(-0.237693, -0.615428);\n    samples[59] = vec2(-0.217313, 0.261084);\n    samples[60] = vec2(-0.998966, 0.025692);\n    samples[61] = vec2(-0.418554, -0.527508);\n    samples[62] = vec2(-0.822629, -0.567797);\n    samples[63] = vec2(0.061945, 0.522105);\n\n    float invRes = 1.0/uRes;\n    vec2 coord = gl_FragCoord.xy * invRes;\n\n    float strength = uDOFStrength * uRes/768.0;\n\n    float depth = texture2D(uDepth, coord).r;\n    float range = uDOFPosition - depth;\n    float scale = abs(range);\n\n    vec4 sample = texture2D(uColor, coord);\n    float count = 1.0;\n    for(int i = 0; i < 64; i++) {\n        vec2 p = samples[i];\n        p = coord + scale * 64.0 * strength * p * invRes;\n        float d = texture2D(uDepth, p).r;\n        float r = uDOFPosition - d;\n        float s = abs(r);\n        sample += texture2D(uColor, p) * s;\n        count += s;\n    }\n\n    gl_FragColor = sample/count;\n}");var e=[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],t=V.buildAttribs(y,{aPosition:3});t.aPosition.buffer.set(new Float32Array(e));var r=e.length/9;new V.Renderable(y,E,t,r),P=new V.Renderable(y,U,t,r),C=new V.Renderable(y,T,t,r),I=new V.Renderable(y,_,t,r),z=new V.Renderable(y,w,t,r),0},D.createTextures=function(){e=new V.Texture(y,0,null,p,p),x=new V.Texture(y,1,null,p,p,{internalFormat:y.DEPTH_COMPONENT,format:y.DEPTH_COMPONENT,type:y.UNSIGNED_SHORT}),M=new V.Framebuffer(y,[e],x),r=new V.Texture(y,2,null,f,f),v=new V.Texture(y,3,null,f,f),b=new V.Texture(y,4,null,f,f,{internalFormat:y.DEPTH_COMPONENT,format:y.DEPTH_COMPONENT,type:y.UNSIGNED_SHORT}),u=new V.Framebuffer(y,[r],b),m=new V.Framebuffer(y,[v],b),h=new V.Texture(y,5,null,f,f),o=new V.Texture(y,6,null,f,f),R=new V.Framebuffer(y,[o]),i=new V.Texture(y,7,null,f,f),c=new V.Framebuffer(y,[i]),a=new V.Texture(y,8,null,f,f),t=new V.Texture(y,9,null,f,f),l=new V.Framebuffer(y,[t]),s=new V.Texture(y,10,null,f,f),new V.Framebuffer(y,[s])},D.setResolution=function(e,t){p=t,f=e,n.width=n.height=f,y.viewport(0,0,f,f),D.createTextures()},D.setSystem=function(e,t){function r(e){for(var t=[],r=0;r<36;r++)t.push.apply(t,e);return t}g=e;for(var n=V.buildAttribs(y,{aImposter:3,aPosition:3,aRadius:1,aColor:3}),o=[],a=[],s=[],i=[],u=0;u<g.atoms.length;u++){o.push.apply(o,H.position);var m=g.atoms[u];a.push.apply(a,r([m.x,m.y,m.z])),s.push.apply(s,r([G[m.symbol].radius]));var l=G[m.symbol].color;i.push.apply(i,r([l[0],l[1],l[2]]))}n.aImposter.buffer.set(new Float32Array(o)),n.aPosition.buffer.set(new Float32Array(a)),n.aRadius.buffer.set(new Float32Array(s)),n.aColor.buffer.set(new Float32Array(i));var c=o.length/9;if(F=new V.Renderable(y,A,n,c),t.bonds&&(B=null,0<g.bonds.length)){n=V.buildAttribs(y,{aImposter:3,aPosA:3,aPosB:3,aRadA:1,aRadB:1,aColA:3,aColB:3}),o=[];var f=[],p=[],d=[],v=[],b=[],x=[];for(u=0;u<g.bonds.length;u++){var h=g.bonds[u];if(h.cutoff>t.bondThreshold)break;o.push.apply(o,H.position),f.push.apply(f,r([h.posA.x,h.posA.y,h.posA.z])),p.push.apply(p,r([h.posB.x,h.posB.y,h.posB.z])),d.push.apply(d,r([h.radA])),v.push.apply(v,r([h.radB])),b.push.apply(b,r([h.colA.r,h.colA.g,h.colA.b])),x.push.apply(x,r([h.colB.r,h.colB.g,h.colB.b]))}n.aImposter.buffer.set(new Float32Array(o)),n.aPosA.buffer.set(new Float32Array(f)),n.aPosB.buffer.set(new Float32Array(p)),n.aRadA.buffer.set(new Float32Array(d)),n.aRadB.buffer.set(new Float32Array(v)),n.aColA.buffer.set(new Float32Array(b)),n.aColB.buffer.set(new Float32Array(x));c=o.length/9;B=new V.Renderable(y,S,n,c)}},D.reset=function(){L=0,O=N=!1,h.reset(),o.reset()},D.render=function(e){if(void 0!==g&&null!=F){if(d=2*j.getRadius(g),N)if(O)for(var t=0;t<e.spf&&!(1024<L);t++)q(e),L++;else!function(e){O=!0,y.viewport(0,0,f,f),m.bind(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);var t=W.getRect(e),r=X.mat4.create();X.mat4.ortho(r,t.left,t.right,t.bottom,t.top,0,d);var n=X.mat4.create();X.mat4.lookAt(n,[0,0,0],[0,0,-1],[0,1,0]);var o=X.mat4.create();X.mat4.translate(o,o,[0,0,-d/2]),X.mat4.multiply(o,o,e.rotation),A.setUniform("uProjection","Matrix4fv",!1,r),A.setUniform("uView","Matrix4fv",!1,n),A.setUniform("uModel","Matrix4fv",!1,o),A.setUniform("uBottomLeft","2fv",[t.left,t.bottom]),A.setUniform("uTopRight","2fv",[t.right,t.top]),A.setUniform("uAtomScale","1f",2.5*e.atomScale),A.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),A.setUniform("uRes","1f",f),A.setUniform("uDepth","1f",d),A.setUniform("uMode","1i",1),A.setUniform("uAtomShade","1f",e.atomShade),F.render(),e.bonds&&null!=B&&(m.bind(),S.setUniform("uProjection","Matrix4fv",!1,r),S.setUniform("uView","Matrix4fv",!1,n),S.setUniform("uModel","Matrix4fv",!1,o),S.setUniform("uRotation","Matrix4fv",!1,e.rotation),S.setUniform("uDepth","1f",d),S.setUniform("uBottomLeft","2fv",[t.left,t.bottom]),S.setUniform("uTopRight","2fv",[t.right,t.top]),S.setUniform("uRes","1f",f),S.setUniform("uBondRadius","1f",2.5*W.getBondRadius(e)),S.setUniform("uBondShade","1f",e.bondShade),S.setUniform("uAtomScale","1f",2.5*e.atomScale),S.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),S.setUniform("uMode","1i",1),B.render())}(e);else!function(e){N=!0,y.viewport(0,0,f,f),u.bind(),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);var t=W.getRect(e),r=X.mat4.create();X.mat4.ortho(r,t.left,t.right,t.bottom,t.top,0,d);var n=X.mat4.create();X.mat4.lookAt(n,[0,0,0],[0,0,-1],[0,1,0]);var o=X.mat4.create();X.mat4.translate(o,o,[0,0,-d/2]),X.mat4.multiply(o,o,e.rotation),A.setUniform("uProjection","Matrix4fv",!1,r),A.setUniform("uView","Matrix4fv",!1,n),A.setUniform("uModel","Matrix4fv",!1,o),A.setUniform("uBottomLeft","2fv",[t.left,t.bottom]),A.setUniform("uTopRight","2fv",[t.right,t.top]),A.setUniform("uAtomScale","1f",2.5*e.atomScale),A.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),A.setUniform("uRes","1f",f),A.setUniform("uDepth","1f",d),A.setUniform("uMode","1i",0),A.setUniform("uAtomShade","1f",e.atomShade),F.render(),e.bonds&&null!=B&&(u.bind(),S.setUniform("uProjection","Matrix4fv",!1,r),S.setUniform("uView","Matrix4fv",!1,n),S.setUniform("uModel","Matrix4fv",!1,o),S.setUniform("uRotation","Matrix4fv",!1,e.rotation),S.setUniform("uDepth","1f",d),S.setUniform("uBottomLeft","2fv",[t.left,t.bottom]),S.setUniform("uTopRight","2fv",[t.right,t.top]),S.setUniform("uRes","1f",f),S.setUniform("uBondRadius","1f",2.5*W.getBondRadius(e)),S.setUniform("uBondShade","1f",e.bondShade),S.setUniform("uAtomScale","1f",2.5*e.atomScale),S.setUniform("uRelativeAtomScale","1f",e.relativeAtomScale),S.setUniform("uMode","1i",0),B.render())}(e);!function(e){y.viewport(0,0,f,f),0<e.fxaa||0<e.dofStrength?c.bind():y.bindFramebuffer(y.FRAMEBUFFER,null);if(y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),T.setUniform("uSceneColor","1i",r.index),T.setUniform("uSceneDepth","1i",b.index),T.setUniform("uAccumulatorOut","1i",o.index),T.setUniform("uRes","1f",f),T.setUniform("uAO","1f",2*e.ao),T.setUniform("uBrightness","1f",2*e.brightness),T.setUniform("uOutlineStrength","1f",e.outline),C.render(),0<e.fxaa){0<e.dofStrength?l.bind():y.bindFramebuffer(y.FRAMEBUFFER,null);for(var t=0;t<e.fxaa;t++)y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),0==t?_.setUniform("uTexture","1i",i.index):_.setUniform("uTexture","1i",a.index),_.setUniform("uRes","1f",f),I.render(),a.activate(),a.bind(),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,f,f,0)}0<e.dofStrength&&(y.bindFramebuffer(y.FRAMEBUFFER,null),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),0<e.fxaa?w.setUniform("uColor","1i",a.index):w.setUniform("uColor","1i",i.index),w.setUniform("uDepth","1i",b.index),w.setUniform("uDOFPosition","1f",e.dofPosition),w.setUniform("uDOFStrength","1f",e.dofStrength),w.setUniform("uRes","1f",f),z.render())}(e)}},D.initialize()}},{"./cube":3,"./elements":4,"./gl-matrix":5,"./system":7,"./view":8,"./webgl.js":9}],7:[function(e,t,r){"use strict";var f=e("./gl-matrix"),p=e("./elements"),d=e("./const"),o=(t.exports.new=function(){return{atoms:[],farAtom:void 0,bonds:[]}},t.exports.calculateBonds=function(e){var t=[],r=e.atoms.slice();r.sort(function(e,t){return e.z-t.z});for(var n=0;n<r.length;n++)for(var o=r[n],a=n+1;a<r.length&&r[a].z<r[n].z+5*d.MAX_ATOM_RADIUS;){var s=r[a],i=f.vec3.fromValues(o.x,o.y,o.z),u=f.vec3.fromValues(s.x,s.y,s.z),m=f.vec3.distance(i,u),l=p[o.symbol],c=p[s.symbol];m<2.5*(l.radius+c.radius)&&t.push({posA:{x:o.x,y:o.y,z:o.z},posB:{x:s.x,y:s.y,z:s.z},radA:l.radius,radB:c.radius,colA:{r:l.color[0],g:l.color[1],b:l.color[2]},colB:{r:c.color[0],g:c.color[1],b:c.color[2]},cutoff:m/(l.radius+c.radius)}),a++}t.sort(function(e,t){return e.cutoff-t.cutoff}),e.bonds=t},t.exports.addAtom=function(e,t,r,n,o){e.atoms.push({symbol:t,x:r,y:n,z:o})},t.exports.getCentroid=function(e){for(var t=0,r=0,n=0,o=0;o<e.atoms.length;o++)t+=e.atoms[o].x,r+=e.atoms[o].y,n+=e.atoms[o].z;return{x:t/e.atoms.length,y:r/e.atoms.length,z:n/e.atoms.length}}),a=(t.exports.center=function(e){for(var t=o(e),r=0;r<e.atoms.length;r++){var n=e.atoms[r];n.x-=t.x,n.y-=t.y,n.z-=t.z}},t.exports.getFarAtom=function(e){if(void 0!==e.farAtom)return e.farAtom;e.farAtom=e.atoms[0];for(var t=0,r=0;r<e.atoms.length;r++){var n=e.atoms[r],o=p[n.symbol].radius,a=2.5*Math.sqrt(o*o+o*o+o*o),s=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z)+a;t<s&&(t=s,e.farAtom=n)}return e.farAtom});t.exports.getRadius=function(e){var t=a(e),r=d.MAX_ATOM_RADIUS,n=2.5*Math.sqrt(r*r+r*r+r*r);return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)+n}},{"./const":2,"./elements":4,"./gl-matrix":5}],8:[function(e,t,r){"use strict";var p=e("./gl-matrix"),d=e("./elements"),n=e("./const");function o(e,t,r){return Math.min(t,Math.max(e,r))}t.exports.new=function(){return{aspect:1,zoom:.125,translation:{x:0,y:0},atomScale:.6,relativeAtomScale:1,bondScale:.5,rotation:p.mat4.create(),ao:.75,aoRes:256,brightness:.5,outline:0,spf:32,bonds:!1,bondThreshold:1.2,bondShade:.5,atomShade:.5,resolution:768,dofStrength:0,dofPosition:.5,fxaa:1}},t.exports.center=function(e,t){for(var r=-1/0,n=1/0,o=-1/0,a=1/0,s=0;s<t.atoms.length;s++){var i=t.atoms[s],u=d[i.symbol].radius;u=2.5*e.atomScale*(1+(u-1)*e.relativeAtomScale);var m=p.vec4.fromValues(i.x,i.y,i.z,0);p.vec4.transformMat4(m,m,e.rotation),r=Math.max(r,m[0]+u),n=Math.min(n,m[0]-u),o=Math.max(o,m[1]+u),a=Math.min(a,m[1]-u)}var l=n+(r-n)/2,c=a+(o-a)/2;e.translation.x=l,e.translation.y=c;var f=Math.max(r-n,o-a);e.zoom=1/(1.01*f)},t.exports.override=function(e,t){for(var r in t)e[r]=t[r];i(e)},t.exports.clone=function(e){return s(a(e))};var a=t.exports.serialize=function(e){return JSON.stringify(e)},s=t.exports.deserialize=function(e){return(e=JSON.parse(e)).rotation=p.mat4.clone(e.rotation),e},i=t.exports.resolve=function(e){e.dofStrength=o(0,1,e.dofStrength),e.dofPosition=o(0,1,e.dofPosition),e.zoom=o(.001,2,e.zoom),e.atomScale=o(0,1,e.atomScale),e.relativeAtomScale=o(0,1,e.relativeAtomScale),e.bondScale=o(0,1,e.bondScale),e.bondShade=o(0,1,e.bondShade),e.atomShade=o(0,1,e.atomShade),e.ao=o(0,1,e.ao),e.brightness=o(0,1,e.brightness),e.outline=o(0,1,e.outline)};t.exports.translate=function(e,t,r){e.translation.x-=t/(e.resolution*e.zoom),e.translation.y+=r/(e.resolution*e.zoom),i(e)},t.exports.rotate=function(e,t,r){var n=p.mat4.create();p.mat4.rotateY(n,n,.005*t),p.mat4.rotateX(n,n,.005*r),p.mat4.multiply(e.rotation,n,e.rotation),i(e)},t.exports.getRect=function(e){var t=1/e.zoom,r=t/e.aspect;return{bottom:-r/2+e.translation.y,top:r/2+e.translation.y,left:-t/2+e.translation.x,right:t/2+e.translation.x}},t.exports.getBondRadius=function(e){return e.bondScale*e.atomScale*(1+(n.MIN_ATOM_RADIUS-1)*e.relativeAtomScale)}},{"./const":2,"./elements":4,"./gl-matrix":5}],9:[function(e,t,r){function o(t){var r=this;r.initialize=function(){r.buffer=t.createBuffer()},r.bind=function(){t.bindBuffer(t.ARRAY_BUFFER,r.buffer)},r.set=function(e){r.bind(),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)},r.initialize()}t.exports.buildAttribs=function(e,t){var r={};for(var n in t)r[n]={buffer:new o(e),size:t[n]};return r},t.exports.getExtensions=function(e,t){for(var r={},n=0;n<t.length;n++){var o=e.getExtension(t[n]);if(null===o)throw"Extension "+t[n]+" not available.";r[t[n]]=o}return r},t.exports.Framebuffer=function(r,n,o,a){var s=this;s.initialize=function(){if(s.fb=r.createFramebuffer(),s.bind(),1<n.length){for(var e=[],t=0;t<n.length;t++)e.push(a["COLOR_ATTACHMENT"+t+"_WEBGL"]);for(a.drawBuffersWEBGL(e),t=0;t<n.length;t++)r.framebufferTexture2D(r.FRAMEBUFFER,a["COLOR_ATTACHMENT"+t+"_WEBGL"],r.TEXTURE_2D,n[t].texture,0)}else r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n[0].texture,0);void 0!==o&&r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,o.texture,0)},s.bind=function(){r.bindFramebuffer(r.FRAMEBUFFER,s.fb)},s.initialize()},t.exports.Texture=function(e,t,r,n,o,a){(a=a||{}).target=a.target||e.TEXTURE_2D,a.mag=a.mag||e.NEAREST,a.min=a.min||e.NEAREST,a.wraps=a.wraps||e.CLAMP_TO_EDGE,a.wrapt=a.wrapt||e.CLAMP_TO_EDGE,a.internalFormat=a.internalFormat||e.RGBA,a.format=a.format||e.RGBA,a.type=a.type||e.UNSIGNED_BYTE;var s=this;s.initialize=function(){s.index=t,s.activate(),s.texture=e.createTexture(),s.bind(),e.texParameteri(a.target,e.TEXTURE_MAG_FILTER,a.mag),e.texParameteri(a.target,e.TEXTURE_MIN_FILTER,a.min),e.texParameteri(a.target,e.TEXTURE_WRAP_S,a.wraps),e.texParameteri(a.target,e.TEXTURE_WRAP_T,a.wrapt),e.texImage2D(a.target,0,a.internalFormat,n,o,0,a.format,a.type,r)},s.bind=function(){e.bindTexture(a.target,s.texture)},s.activate=function(){e.activeTexture(e.TEXTURE0+s.index)},s.reset=function(){s.activate(),s.bind(),e.texImage2D(a.target,0,a.internalFormat,n,o,0,a.format,a.type,r)},s.initialize()},t.exports.GLBuffer=o,t.exports.Renderable=function(n,o,a,s){var i=this;i.primitiveCount=s,i.initialize=function(){},i.render=function(){for(name in o.use(),a){var e=a[name].buffer,t=a[name].size;try{var r=o.attribs[name].location}catch(e){throw console.log("Could not find location for",name),e}e.bind(),n.enableVertexAttribArray(r),n.vertexAttribPointer(r,t,n.FLOAT,!1,0,0)}for(name in n.drawArrays(n.TRIANGLES,0,3*s),i.buffers)n.disableVertexAttribArray(o.attributes[name].location)},i.initialize()},t.exports.InstancedRenderable=function(n,o,a,s,i){var u=this;u.initialize=function(){},u.render=function(){for(name in o.use(),a){var e=a[name].buffer,t=a[name].size;try{var r=o.attribs[name].location}catch(e){throw console.log("Could not find location for",name),e}e.bind(),n.enableVertexAttribArray(r),n.vertexAttribPointer(r,t,n.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(r,a[name].divisor)}for(name in i.drawArraysInstancedANGLE(n.TRIANGLES,0,36,s),u.buffers)n.disableVertexAttribArray(o.attributes[name].location)},u.initialize()},t.exports.Program=function(u,e,t){var a=this;a.initialize=function(){a.program=a.compileProgram(e,t),a.attribs=a.gatherAttribs(),a.uniforms=a.gatherUniforms()},a.use=function(){u.useProgram(a.program)},a.compileProgram=function(e,t){var r=a.compileShader(e,u.VERTEX_SHADER),n=a.compileShader(t,u.FRAGMENT_SHADER),o=u.createProgram();if(u.attachShader(o,r),u.attachShader(o,n),u.linkProgram(o),!u.getProgramParameter(o,u.LINK_STATUS))throw console.log(u.getProgramInfoLog(o)),"Failed to compile program.";return o},a.compileShader=function(e,t){var r=u.createShader(t);if(u.shaderSource(r,e),u.compileShader(r),!u.getShaderParameter(r,u.COMPILE_STATUS)){var n=u.getShaderInfoLog(r),o=parseInt(n.split(":")[2]),a=e.split("\n");for(var s in a){var i=parseInt(s);console.log(i+"  "+a[s]),s==o-1&&console.warn(n)}throw typeString=t==u.VERTEX_SHADER?"vertex":"fragment","Failed to compile "+typeString+" shader."}return r},a.setUniform=function(t,e,r){var n=Array.prototype.slice.call(arguments,2);a.use();try{var o=a.uniforms[t].location}catch(e){throw console.log(t),e}u["uniform"+e].apply(u,[o].concat(n))},a.gatherUniforms=function(){for(var e={},t=u.getProgramParameter(a.program,u.ACTIVE_UNIFORMS),r=0;r<t;r++){var n=u.getActiveUniform(a.program,r);e[n.name]={name:n.name,location:u.getUniformLocation(a.program,n.name),type:n.type,size:n.size}}return e},a.gatherAttribs=function(){for(var e={},t=u.getProgramParameter(a.program,u.ACTIVE_ATTRIBUTES),r=0;r<t;r++){var n=u.getActiveAttrib(a.program,r);e[n.name]={name:n.name,location:u.getAttribLocation(a.program,n.name),type:n.type,size:n.size}}return e},a.initialize()}},{}],10:[function(e,t,r){t.exports=function(e){for(var t=e.split("\n"),r=parseInt(t[0]),n=Math.floor(t.length/(r+2)),o=[],a=0;a<n;a++){for(var s=[],i=0;i<r;i++){for(var u=t[a*(r+2)+i+2].split(/\s+/),m={},l=0;""==u[l];)l++;m.symbol=u[l++],m.position=[parseFloat(u[l++]),parseFloat(u[l++]),parseFloat(u[l++])],s.push(m)}o.push(s)}return o}},{}]},{},[1]);